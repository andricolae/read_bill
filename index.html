<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <title>OCR Bon de Cumpărături</title>
</head>
<body>
    <h1>Scanare Bon de Cumpărături</h1>

    <!-- Elementul video pentru afișarea fluxului de la cameră -->
    <video id="video" width="300" height="400" autoplay></video>
    <br>

    <!-- Buton pentru capturarea imaginii -->
    <button id="capture">Capturează Imaginea</button>
    <br><br>

    <!-- Afișarea textului extras -->
    <h3>Textul extras:</h3>
    <pre id="output"></pre>

    <!-- Scripturile necesare -->
    <!-- Include Tesseract.js -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2/dist/tesseract.min.js"></script>

    <!-- Scriptul principal -->
    <script>
        const video = document.getElementById('video');
        const captureButton = document.getElementById('capture');
        const output = document.getElementById('output');

        // Setăm constrângerile pentru a folosi camera de pe spate
        const constraints = {
            video: {
                facingMode: { exact: "environment" } // Utilizează camera de pe spate
            }
        };

        // Cerem acces la camera video
        navigator.mediaDevices.getUserMedia(constraints)
            .then(stream => {
                video.srcObject = stream;
                video.play();
            })
            .catch(error => {
                console.error("Eroare la accesarea camerei:", error);
                alert("Nu am putut accesa camera de pe spate.");
            });

        // Eveniment la apăsarea butonului de captură
        captureButton.addEventListener('click', () => {
            // Cream un canvas temporar pentru capturarea imaginii
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const context = canvas.getContext('2d');

            // Desenăm cadrul curent din video în canvas
            context.drawImage(video, 0, 0, canvas.width, canvas.height);

            // Convertim canvas-ul în blob și trimitem la Tesseract
            canvas.toBlob(blob => {
                Tesseract.recognize(
                    blob,
                    'ron', // Limba română; poți schimba în 'eng' pentru engleză
                    { logger: m => console.log(m) }
                ).then(({ data: { text } }) => {
                    output.textContent = text;
                })
                .catch(err => {
                    console.error("Eroare la OCR:", err);
                });
            }, 'image/png');
        });
    </script>
</body>
</html>
